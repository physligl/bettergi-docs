## 脚本作者指南
### 1. 制作地图追踪脚本前的准备
#### 1.1 选择需要制作的地图追踪脚本
- 目前地图追踪只支持最大的地表地图，不支持 `分层地图` 识别。也不支持 `渊下宫`、`层岩巨渊` 等地底地图。因此，如果你想要制作的脚本位于这些区域，请暂时放弃你的想法，等待 `BetterGI` 版本更新。
- 在特征不明显的地区表现很差，可能无法正确识别出位置，比如 `须弥沙漠`、`风起地`等。因此，如果你的脚本位于这些区域，请谨慎尝试。
- 准备制作脚本之前，前往脚本仓库 [bgi.sh](https://bgi.sh) 或者 [github](https://github.com/babalae/bettergi-scripts-list) 确定仓库中并没有你想要制作的脚本，如果有，不要重复造轮子。如果你觉得原有脚本不好用或者有问题，优先在原来的基础上修改，除非发现完全无法修改，再考虑重新制作。
- 准备制作脚本之前，建议前往社区交流沟通，看看是否有别的作者意图制作该脚本，避免撞车。如果没有制作脚本的经验，可以和有经验的作者请教，请教之前请确保你已经认真阅读了本指南。
#### 1.2 准备录制环境
- 在录制前到 `地图追踪` - `录制编辑器` 打开录制编辑器（可选，建议打开）。
- 在 `快捷键` - `开发者` 绑定以下的快捷键：1. **启动/停止路径记录器**：启动或停止记录过程（未打开录制编辑器的情况下停止路径记录器会直接保存文件）。2. **添加路径点**：在路径中添加一个记录点。
- 以 `16:9` 且大于等于 `1920x1080` 分辨率启动原神。确保原神界面存在日志遮罩。

### 2. 制作地图追踪脚本
#### 2.1 通过路径记录器获取路径点
- 传送到需要录制脚本的起点位置，然后通过快捷键 `启动路径记录器`，启动时间可能较长，请等待。当日志遮罩窗口出现坐标记录时即启动成功。
- 在所有需要经过的路径点使用快捷键 `添加路径点`。
- 完成路径点的采集后，再次通过快捷键 `启动路径记录器`，完成路径点的采集。

注意事项：
- 时刻关注日志输出的点位数据。如果输出 `(12288,6144)` 的坐标，意味着识别小地图坐标失败了，可能是该坐标的特征点不明显或者出现了未知错误，尝试重启路径记录器之后重试。
![image](https://github.com/user-attachments/assets/0fe9851a-5195-4f18-8755-35b60d7ce545)
- 如果同时开启了录制编辑器，点位数据会实时同步到录制编辑器中。而如果没有启动录制编辑器，记录的路径点会保存在 `\User\AutoPathing` 目录下。并且会在 `BetterGI` 的 `路径追踪` 和 `调度器` 生成的脚本文件。
- 路径记录器并不会录制键鼠操作和实际走过的路径，因此脚本作者无需担忧自己录制时移动到路径点的方式会对最终的脚本有任何影响。

#### 2.2 认识路径点的属性
一个完整的路径点包括七个字段，如下表。本节的目的是通过简单的介绍对路径点的基本属性有所认识。
| 字段名          | 类型  |  描述   |   详细信息                                                                                                                |
|-----------------|-------|---------|---------------------------------------------------------------------------------------------------------------------------|
| `id`            | 整数   | 编号     | 每个路径点的编号  |
| `x`             | 浮点数 |X 坐标    | 原神游戏内坐标系下的X坐标 |
| `y`             | 浮点数 |Y 坐标    | 原神游戏内坐标系下的Y坐标  |
| `type`          | 字符串 | 点位类型 | 点位类型（决定如何处理这个点），包括以下类型：<br>`teleport`：传送点，会触发自动传送操作 <br>`path`：途经点，粗略路过的点位 <br>`target`：目标点，精准经过的点位 <br>`orientation`：朝向点，只会朝向对应点位             |
| `move_mode`     | 字符串 | 移动模式 | 移动模式（决定如何移动到这个点），包括以下类型：<br>`walk`： 持续行走，较远时会偶尔冲刺 <br>`jump`：持续跳跃<br> `fly`：持续跳跃直到起飞 <br> `climb`：不会因为长时间在一个点导致触发自动避障 <br> `run`：持续奔跑 <br> `dash`：消耗体力快速冲刺 |
| `action`        | 字符串 | 动作     | 表示在该位置执行的动作，和移动相关的动作，一般到达点位后执行。                                                                            |
| `action_params` | 字符串 | 动作参数 | 与动作配合使用。                                                                                                |

- `id` 字段仅仅记录路径点的编号，帮助脚本作者定位路径点的位置。在通过路径记录器获取路径之后， `BetterGI` 会自动为脚本生成编号，但实际上 `BetterGI` 并不要求这些编号是连续的。虽然如此，但是我们并不推荐使用不连续的路径点编号。
- `x` 和 `y` 是原神坐标系下的坐标，该坐标的获取和识别完全基于左上角的小地图和按 `M` (如果改键可能是别的按键) 打开的大地图确定，所以为什么在运行脚本的时候会发现角色像是完全没在看路一样，那是因为 `BetterGI` 控制的角色只会看左上角的小地图移动。
- `type` 字段记录着点位类型，表格已经对四种类型有相对详细的说明。值得补充的是，`target` 类型的点位实际上只是在完成粗略路过后，再通过小碎步完成精确接近。因此当指定路径点为 `target` 时，消耗的时间会显著增加，这在获取采集物时非常有用，但是在部分路径点可能会取得相反的效果，脚本作者在考虑某些点位应该使用 `target` 还是 `path` 时需要相当慎重，不能盲目因为采集物在这个点位就使用 `target`，虽然在采集物点位使用 `target` 在很多时候是正确的。而对于传送点和朝向点，将会在稍后的部分介绍。
- `move_mode` 决定了移动到路径点的方式，不同的移动方式有一些区别，将在稍后介绍。
- `action` 和 `action_params` 大部分情况下决定了到达点位后执行什么动作。 将会在稍后的部分介绍。
#### 2.3 修改路径点属性
##### 2.3.1（录制编辑器）
完成 2.1 步骤之后，如果打开了 `录制编辑器`，将得到以下的界面。此时的脚本一般情况下是不能直接运行的，需要进行修改。
![image](https://github.com/user-attachments/assets/896fccc5-93b6-4a49-9aed-7b7c85c1643e)



录制编辑器允许修改其中五个字段，包括 `X坐标`、`Y坐标`、`类型`、`移动方式`、`动作`，并且可以预览和可视化的修改路径。



#### 2.3 修改路径点属性（文本编辑器）
如果没有使用录制编辑器，或者使用录制编辑器导出之后，脚本文件会

#### 2.4 制作自己的脚本
##### 2.4.1 让脚本进行传送
让脚本进行传送非常简单，仅仅需要给出路径点的坐标以及把 `type` 字段改成 `teleport`。`BetterGI` 目前内置了 `5.3` 版本以前几乎所有的大地图传送点坐标，包括 `七天神像`、`传送锚点`、`秘境`、`纳塔声望点`，也包括大地图中分层地图的传送点，仅有少数坐标如 `锻石之轮`、`群玉阁`、`揭示之书`、`水仙十字结社`并未内置，当 `BetterGI` 识别到该点位的类型是传送时，会自动寻找离指定坐标最近的传送点，并点击传送点完成传送。一个典型的传送写法如下：
```json
    {
      "type": "teleport",
      "x": 3397.59,
      "y": -1174.52
    },
```
以上写法意味着当 `BetterGI` 会在 `(3397.59, -1174.52)` 附近寻找传送点，并传送到该传送点。默认情况下，当脚本作者开始录制一个脚本时，路径记录器会自动把录制的第一个点设置成传送点。同时我们非常推荐所有脚本的第一个点设置为传送点，以避免用户只选择运行部分脚本时或者上传脚本仓库时导致脚本顺序错乱时发生错误。

当指定一个路径点为传送点时，`BetterGI` 会忽略所有的 `action` 和 `move_mode` 字段，除了 `"action": "force_tp"`。当设置传送点的动作为 `force_tp` 时，`BetterGI` 会强制以脚本作者指定的坐标为传送点坐标，这是一种兜底的传送手段，当出现 `BetterGI` 没有内置的传送点，而脚本需要以该点为传送点进行传送时，就需要使用这个参数。具体情形包括使用自制锚点（我们不推荐使用自制锚点的脚本上传到仓库）以及上面提到的未内置的传送点。
##### 2.4.2 让脚本行走、奔跑、游泳和攀爬
- 请确保所有相邻的点位都可以通过 **直线** 到达。因为
- 相邻两个点位之间尽量避免存在障碍物（包括矿、树、石头等）。
- 请不要过于频繁地录制路径点（每个路径点不要太近），频繁录制将导致视角震荡等问题。
- 如果经过特征点不明显的点位，如果采集物不在附近，考虑通过绕路到达目标点位。
##### 2.4.3 让脚本飞行和下落攻击

##### 2.4.4 让脚本完成采集任务

##### 2.4.5 让脚本进行战斗

##### 2.4.6 脚本高级语法 `combat_script`

##### 2.4.7 其他补充
- 输出日志
- 上下移动视角按T前往四叶印
- 在点位周围转圈移动

### 3. 测试脚本
在脚本制作完成之后，脚本的测试是必不可少的步骤。即使是经验丰富的脚本作者，在制作完脚本之后也需要经过多轮测试，经过测试确保能够稳定复现才是优秀的脚本。一般而言，脚本制作完成后需要经过几轮自测，自测没问题之后，可以前往社区寻找其他用户帮忙测试。如果你是初次尝试制作脚本，非常推荐将你制作的脚本发布到社区进行测试，社区有许多经验丰富的脚本制作者会给你的脚本提出可供参考的修改建议。

### 4. 发布脚本
制作完成脚本之后，你可以选择自用，也可以选择发布到 `脚本仓库`。发布到 `脚本仓库` 之前，请检查你每个脚本的 `info` 字段，它位于脚本的开头，格式如下
```json  
  "info": {
    "name": "脚本名称",
    "type": "脚本类型",
    "author": "脚本作者",
    "version": "1.0",
    "description": "脚本描述",
    "bgiVersion": "0.42.0"
  },
```
通过录制编辑器导出的版本会提示填写部分字段，包括脚本名称，脚本作者，脚本描述，和脚本的版号。接下来简单介绍一下对于这些字段填写的建议，这些建议并不是强制的，但是我们非常推荐你这么做。
- `name` : 保持和文件名一致。脚本名称建议包含采集物、怪物的名称，包含多个采集物、怪物的情况下，可以通过恰当的分隔符分隔。如果你的脚本是一个系列，强烈建议使用某种能够让脚本按顺序排列的标志放在名称的开头，如 `01`、`02`。
- `type` : 填写 `collect`（采集） 或者 `fight`（战斗），或者其他能够描述类型的单词，目前仅用于展示。
- `author` : 你的名字，不推荐使用真名。填写你行走江湖的网名。
- `version` : 版本管理。测试版本建议 0 开头，如 `0.1`，`0.0.1`，正式版本从 `1.0.0` 或者 `1.0` 开始。如果你的脚本只是小型脚本，使用两位数的版本号比较恰当，如果是大型脚本，使用三位数可以方便定位小型更新和大型更新。
- `description` : 脚本的详细描述，详细介绍这个脚本的主要功能和注意事项。
- `bgiVersion` : 运行你的脚本所需的最低 `BetterGI` 版本，如果低于这个版本运行脚本将会在日志窗口报错，不建议这个值低于 `0.42.0`，如果你使用的特定 `action` 或者其他字段强调了更新的版本，请把这个值设置成大于等于该版本。

最后，如果你选择发布到 [脚本仓库](https://github.com/babalae/bettergi-scripts-list)，请参考 [纯网页端 PR 教程](/src/dev/js/pr.md)。目前脚本仓库对于上传的脚本只进行格式的审查，这意味着即使你的脚本未经过测试流程，也能发布到脚本仓库，即使如此，我们也强烈建议你使用。由于脚本未严格审查可用性，因此目前脚本仓库存在许多有问题的脚本，如果你觉得这些脚本有用，但是不够完美，欢迎提起 PR 修改这些问题脚本。



### 5. 脚本样例
```json
{
  "info": {
    "name": "示例名称",
    "type": "collect"
  },
  "positions": [
    {
      "action": "",
      "move_mode": "walk",
      "type": "teleport",
      "x": 3397.591796875001,
      "y": -1174.529296875
    },
    {
      "action": "",
      "move_mode": "fly",
      "type": "path",
      "x": 3376.546386718751,
      "y": -1133.45263671875
    },
    {
      "action": "stop_flying",
      "move_mode": "fly",
      "type": "path",
      "x": 3366.349609375001,
      "y": -1111.7900390625
    },
    {
      "action": "",
      "move_mode": "walk",
      "type": "target",
      "x": 3346.599609375001,
      "y": -1085.44873046875
    }
  ]
}
```


----------------------------
以下是保留的部分原文档内容，完稿后会删除。

注意：

- 这个功能实际不会录制你的路径，只是在你按下快捷键时记录当前所在点位，你可以直接在录制编辑器中编辑，也可以手动修改点位文件。
- 如果要完成一个“下落攻击退出飞行状态”的动作，请在空中记录一次路径点，并在下落攻击落地后再记录一个路径点。并且修改空中点位的 `action` 。
- ，相距较远的路径点会使用疾跑等方式快速接近并不断修正误差，
- **录制完成后一定要进行测试！有些时候小地图识别失败会返回一个固定坐标的路径点！**
- 🗺️ 录制编辑器也提供了在线版：[https://bgi-map.huiyadan.com/](https://bgi-map.huiyadan.com/)

## 地图追踪文件格式

文件示例：



解释：

- `info` 对象包含了基础信息（当前除了展示没啥用）

| 字段名      | 描述   | 详细信息                          |
|----------|------|-------------------------------|
| `name`   | 名称   | 建议和文件名一致                      |
| `type`   | 路径类型 | 当前此字段除了展示无作用 <br>`collect`：采集 |
| `author` | 作者   | 作者信息                          |

- `positions` 数组包含了一系列的对象，每个对象代表一个游戏内位置和相关的动作信息。

| 字段名             | 描述   | 详细信息                                                                                                                |
|-----------------|------|---------------------------------------------------------------------------------------------------------------------|
| `x`             | X 坐标 | 原神游戏内坐标系下的X坐标                                                                                                       |
| `y`             | Y 坐标 | 原神游戏内坐标系下的Y坐标                                                                                                       |
| `type`          | 点位类型 | `teleport`：传送点，会触发自动传送操作 <br>`path`：途经点，粗略路过的点位 <br>`target`：目标点，精准经过的点位 <br>`orientation`：朝向点，只会朝向对应点位             |
| `move_mode`     | 移动模式 | `walk`： 普通的行走模式，较远时会偶尔冲刺 <br> `fly`：不停的跳跃直到起飞 <br> `climb`：不会因为长时间在一个点导致触发自动避障 <br> `run`：持续奔跑 <br> `dash`：消耗体力快速冲刺 |
| `action`        | 动作   | 表示在该位置执行的动作，和移动相关的动作，都会在精确到达点位后执行。具体见下表                                                                             |
| `action_params` | 动作参数 | 与动作配合使用，具体什么时候使用见下表                                                                                                 |

- `action` 可以有的值

| `action`值           | 描述                                                                                                                                                                  |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `stop_flying`       | 下落攻击，停止飞行，`move_mode = fly`的情况才有效，`action_params`中可以填写滞空的时间，单位为秒（0.43.2 存在）。                                                                                                                                  |
| `force_tp`          | 强制以当前的x,y坐标进行自动传送，`type = teleport`的情况才有效。                                                                                                                          |
| `nahida_collect`    | 使用纳西妲长按E技能进行收集。                                                                                                                                                     |
| `pick_around`       | 在点位周围转圈移动，适合拾取等场景。`action_params` 可以填写数字，代表圈数，圈数越大拾取的范围也越大，不填默认为1                                                                                                   |
| `hydro_collect`     | 使用水元素力收集(0.35.5存在)。[查看支持角色](https://github.com/babalae/better-genshin-impact/blob/main/BetterGenshinImpact/GameTask/AutoPathing/Handler/ElementalCollectHandler.cs) |
| `electro_collect`   | 使用雷元素力收集(0.35.5存在)。[查看支持角色](https://github.com/babalae/better-genshin-impact/blob/main/BetterGenshinImpact/GameTask/AutoPathing/Handler/ElementalCollectHandler.cs) |
| `anemo_collect`     | 使用风元素力收集(0.35.5存在)。[查看支持角色](https://github.com/babalae/better-genshin-impact/blob/main/BetterGenshinImpact/GameTask/AutoPathing/Handler/ElementalCollectHandler.cs) |
| `pyro_collect`      | 使用火元素力收集(0.43.0存在)。[查看支持角色](https://github.com/babalae/better-genshin-impact/blob/main/BetterGenshinImpact/GameTask/AutoPathing/Handler/ElementalCollectHandler.cs) |
| `up_down_grab_leaf` | 上下移动视角按T前往四叶印(0.35.1存在)。                                                                                                                                            |
| `fight`             | 在此处直接执行自动战斗（0.36.4更新了结束方式），此 `action` 的点位一定会按照`path`类型的点位进行执行。                                                                                                      |
| `combat_script`     | 可以直接执行[战斗策略脚本](/feats/task/domain.html#战斗策略脚本编写)，策略脚本需要填写在 `action_params` 中。<br>当策略不指定角色名时，会直接使用当前角色执行策略脚本。<br>请注意活用战斗策略的特性：不存在队伍中的角色对应的策略也不会执行（0.36.4新增）。         |
| `log_output`        | 在遮罩窗口输出INF级别的日志。`action_params`中填写预期的日志输出。注：在移动到目标点之前输出日志，`type = teleport` 时不支持此action。(0.40.0新增)                                                                  |           
| `fishing`           | 执行钓鱼(0.43.0存在)                                                                                                                                                      |           |


- 全地图传送点坐标合集，如果传送位置不对可以对照这个图看下。（最高到5.0版本，且和当前软件内置的传送点合集有区别）

[https://wwmy.lanzouq.com/b0fosbd9g](https://wwmy.lanzouq.com/b0fosbd9g) 密码:coco